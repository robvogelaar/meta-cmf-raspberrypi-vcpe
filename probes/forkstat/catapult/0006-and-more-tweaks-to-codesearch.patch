From b2e9403426f2d99c0b0c8f9c0c4c5df131397c9f Mon Sep 17 00:00:00 2001
From: Rob Vogelaar <revogelaar@gmail.com>
Date: Thu, 25 Mar 2021 18:42:58 -0700
Subject: [PATCH 6/9] and more tweaks to codesearch

Signed-off-by: Rob Vogelaar <revogelaar@gmail.com>
---
 .../tracing/ui/extras/chrome/codesearch.html  | 19 +++++++++++++++++--
 1 file changed, 17 insertions(+), 2 deletions(-)

diff --git a/tracing/tracing/ui/extras/chrome/codesearch.html b/tracing/tracing/ui/extras/chrome/codesearch.html
index 8411d5c15..ead325f10 100644
--- a/tracing/tracing/ui/extras/chrome/codesearch.html
+++ b/tracing/tracing/ui/extras/chrome/codesearch.html
@@ -35,10 +35,25 @@ tr.exportTo('tr.ui.e.chrome', function() {
       //const codeSearchURL =
       //  'https://cs.chromium1.org/search/?sq=package:chromium&type=cs&q=';
       //link.setAttribute('href', codeSearchURL + encodeURIComponent(phrase));
-
       //link.setAttribute('href', window.location.href.split('&cmd=')[0]+'&cmd=' + encodeURIComponent(phrase.split(':')[1].split(' ')[0]));
+
       var searchParams = new URLSearchParams(window.location.search)
-      searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1]));
+      //searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1]));
+      if (phrase.split(':')[1].startsWith('/bin/sh -c '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[2]));
+      else if (phrase.split(':')[1].startsWith('/bin/sh '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[1]));
+      else if (phrase.split(':')[1].startsWith('/bin/bash '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[1]));
+      else if (phrase.split(':')[1].startsWith('sh -c '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[2]));
+      else if (phrase.split(':')[1].startsWith('sh -c sh '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[3]));
+      else if (phrase.split(':')[1].startsWith('sh '))
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[1]));
+      else
+        searchParams.set("cmd", encodeURIComponent(phrase.split(':')[1].split(' ')[0]));
+
       link.setAttribute('href', window.location.pathname.replace('forkstat-iframe', 'forkstat') + '?' + searchParams.toString());
     },
 
-- 
2.25.1

